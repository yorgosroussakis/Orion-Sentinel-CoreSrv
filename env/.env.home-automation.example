# Home Automation Stack Configuration
# Home Assistant + Mosquitto + Zigbee2MQTT + Mealie + DSMR Reader

# ============================================================================
# USER/GROUP & TIMEZONE
# ============================================================================
TZ=Europe/Amsterdam
PUID=1000
PGID=1000

# ============================================================================
# HOST DIRECTORY LAYOUT
# ============================================================================
CONFIG_ROOT=/srv/orion-sentinel-core/config

# ============================================================================
# DOMAIN CONFIGURATION (for future use)
# ============================================================================
# Base domain for all services
# Currently, all Traefik host rules use '.local' domain hardcoded
# This variable is here for future flexibility if you want to use a real domain
# Example: BASE_DOMAIN=homelab.example.com would give you ha.homelab.example.com
# 
# To use this variable, update compose.yml Traefik labels from:
#   - "traefik.http.routers.service.rule=Host(`service.local`)"
# To:
#   - "traefik.http.routers.service.rule=Host(`service.${BASE_DOMAIN}`)"
#
BASE_DOMAIN=local

# ============================================================================
# HOME ASSISTANT
# ============================================================================
# Home Assistant handles smart home automation, integrations, and monitoring

# Network mode options:
# - 'host' mode (recommended for mDNS discovery, requires direct host access)
# - 'bridge' mode (current default, integrates with Traefik)
# Current setup: bridge mode with Traefik (https://ha.local)

# To enable host networking for better device discovery:
# 1. Comment out 'networks' and 'labels' in compose.yml
# 2. Uncomment 'network_mode: host'
# 3. Access via: http://<coresrv-ip>:8123

# ============================================================================
# MOSQUITTO (MQTT BROKER)
# ============================================================================
# MQTT broker for IoT devices and Zigbee2MQTT

# MQTT Credentials (optional, but recommended)
# Leave empty for anonymous access (LAN-only)
MQTT_USER=
MQTT_PASSWORD=

# To enable authentication:
# 1. Set MQTT_USER and MQTT_PASSWORD above
# 2. Create mosquitto config at: ${CONFIG_ROOT}/mosquitto/config/mosquitto.conf
# 3. Add password file using: mosquitto_passwd -c passwordfile <username>

# ============================================================================
# ZIGBEE2MQTT
# ============================================================================
# Zigbee USB coordinator device path
# Common paths:
#   - /dev/ttyACM0 (most USB Zigbee coordinators)
#   - /dev/ttyUSB0 (some older models)
#   - /dev/serial/by-id/usb-... (persistent device path, recommended)
#
# Find your device: ls -l /dev/serial/by-id/
ZIGBEE_DEVICE=/dev/ttyACM0

# Zigbee2MQTT will connect to Mosquitto automatically
# Web UI available at: https://zigbee.local

# ============================================================================
# MEALIE (RECIPE MANAGEMENT)
# ============================================================================
# Mealie - recipe and meal planning application

# Allow new user signups (set to 'false' after creating admin account)
MEALIE_ALLOW_SIGNUP=true

# Default admin credentials (change on first login!)
# These are only used for initial setup
MEALIE_DEFAULT_EMAIL=admin@local
MEALIE_DEFAULT_PASSWORD=changeme

# ============================================================================
# DSMR READER (DUTCH SMART METER)
# ============================================================================
# DSMR Reader - Dutch smart meter (P1 port) data logger and analyzer

# Serial port for P1 cable connection
# Common paths:
#   - /dev/ttyUSB0 (most USB-to-serial adapters)
#   - /dev/ttyUSB1 (if ttyUSB0 is used by Zigbee)
#   - /dev/serial/by-id/usb-... (persistent device path, recommended)
#
# Find your device: ls -l /dev/serial/by-id/
DSMR_SERIAL_PORT=/dev/ttyUSB0

# Database configuration
DSMR_DB_NAME=dsmrreader
DSMR_DB_USER=dsmrreader
DSMR_DB_PASSWORD=changeme_generate_random_password

# DSMR Reader web interface credentials
DSMR_USER=admin
DSMR_EMAIL=admin@local
DSMR_PASSWORD=changeme_use_strong_password

# ============================================================================
# HARDWARE REQUIREMENTS
# ============================================================================
# For full home automation suite, you'll need:
#
# 1. Zigbee USB Coordinator (for Zigbee2MQTT)
#    - Recommended: Sonoff Zigbee 3.0 USB Dongle Plus
#    - Alternative: ConBee II, CC2531, CC2652
#    - ~€15-30
#
# 2. P1 Cable (for DSMR Reader - Dutch smart meter)
#    - USB to P1 RJ12 cable
#    - Only needed if you have a Dutch smart meter with P1 port
#    - ~€15-25
#
# If you don't have the hardware, you can:
# - Skip Zigbee2MQTT (use Home Assistant ZHA integration instead)
# - Skip DSMR Reader (not needed outside Netherlands)
# - Still run: Home Assistant, Mosquitto, and Mealie

# ============================================================================
# SERVICE ACCESS URLS
# ============================================================================
# After starting the home-automation profile:
#
# Home Assistant:    https://ha.local
# Zigbee2MQTT:       https://zigbee.local
# Mealie:            https://mealie.local
# DSMR Reader:       https://energy.local
# Homepage:          https://home.local (for dashboard overview)
#
# Note: Add these to your /etc/hosts or use local DNS if not using .local domains

# ============================================================================
# INTEGRATIONS (configure in Home Assistant UI)
# ============================================================================
# Recommended integrations to add after setup:
#
# 1. MQTT Integration
#    - Settings → Devices & Services → Add Integration → MQTT
#    - Broker: mosquitto, Port: 1883
#    - Leave user/password empty (or use MQTT_USER/MQTT_PASSWORD if set)
#
# 2. Zigbee2MQTT Integration
#    - Automatic via MQTT Discovery (should appear automatically)
#    - Or install via HACS: https://github.com/zigbee2mqtt/hassio-zigbee2mqtt
#
# 3. DSMR Integration (if using DSMR Reader)
#    - Settings → Devices & Services → Add Integration → DSMR Reader
#    - Or use DSMR direct serial integration if preferred
#
# 4. Jellyfin Integration
#    - For media monitoring and control
#    - Install via HACS
#
# 5. System Monitor
#    - Built-in, just enable via: Configuration → Integrations
#
# 6. Mobile App
#    - Install Home Assistant Companion app (iOS/Android)
#    - For presence detection and notifications

# ============================================================================
# BACKUP NOTES
# ============================================================================
# Critical directories to backup:
#   - ${CONFIG_ROOT}/homeassistant/     (HA config, automations, integrations)
#   - ${CONFIG_ROOT}/mosquitto/         (MQTT broker config)
#   - ${CONFIG_ROOT}/zigbee2mqtt/       (Zigbee device database)
#   - ${CONFIG_ROOT}/mealie/            (recipes and meal plans)
#   - ${CONFIG_ROOT}/dsmr/              (energy data)
#
# Home Assistant built-in backup: Settings → System → Backups
# Recommended: Weekly full backups of entire CONFIG_ROOT

# ============================================================================
# QUICK START
# ============================================================================
# 1. Copy this file: cp env/.env.home-automation.example env/.env.home-automation
# 2. Edit: vim env/.env.home-automation
# 3. Set your timezone, device paths, and passwords
# 4. Start services: docker compose --profile home-automation up -d
# 5. Access Home Assistant: https://ha.local
# 6. Complete HA onboarding wizard
# 7. Add MQTT integration pointing to 'mosquitto'
# 8. Add Zigbee devices via https://zigbee.local
# 9. Access Mealie: https://mealie.local
# 10. Access DSMR Reader: https://energy.local
