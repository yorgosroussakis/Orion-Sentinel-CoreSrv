# Orion-Sentinel NVR Module Configuration (Frigate)
# Network Video Recorder for RTSP cameras
#
# Usage:
#   1. Copy this file: cp env/.env.nvr.example env/.env.nvr
#   2. Edit the file to customize your settings
#   3. Start NVR: make up-nvr  OR  ./scripts/orionctl up nvr

# =============================================================================
# USER/GROUP & TIMEZONE
# =============================================================================
PUID=1000
PGID=1000
TZ=Europe/Amsterdam

# =============================================================================
# STORAGE PATHS
# =============================================================================
# Frigate configuration directory (contains config.yml)
# By default uses the repo's config/frigate directory
NVR_CONFIG_ROOT=./config/frigate

# Recordings storage path
# IMPORTANT: Point this to a large SSD with sufficient space for recordings
# Recommended: 1TB+ for multi-camera 24/7 recording
# For Dell deployment: Use ${ORION_EXTERNAL_PRIMARY}/cameras or ${ORION_CAMERAS_DIR}
ORION_CCTV_MEDIA_DIR=/mnt/orion-cctv

# Directory structure on media volume:
# /mnt/orion-cctv/
# ├── recordings/          # Continuous recordings
# │   └── <camera>/
# │       └── YYYY-MM-DD/
# ├── clips/               # Event clips
# └── exports/             # Manual exports

# =============================================================================
# DOMAIN CONFIGURATION
# =============================================================================
# Domain for Traefik routing (requires gateway module)
LOCAL_DOMAIN=orion.lan

# =============================================================================
# FRIGATE SETTINGS
# =============================================================================
# Shared memory size for video processing
# 64mb per camera is a good baseline
# Increase if you have many cameras or high resolution streams
FRIGATE_SHM_SIZE=256mb

# RTSP restream password (optional)
# Used for authenticated access to Frigate's RTSP restreams
FRIGATE_RTSP_PASSWORD=

# =============================================================================
# MQTT INTEGRATION (Optional)
# =============================================================================
# MQTT enables real-time event notifications and Home Assistant integration
# Leave empty to disable MQTT (Frigate will still work for recording)

# MQTT broker hostname
# Use 'orion_mosquitto' if running the homeauto module
# Or set to your external MQTT broker address
FRIGATE_MQTT_HOST=

# MQTT credentials (if your broker requires authentication)
FRIGATE_MQTT_USER=frigate
FRIGATE_MQTT_PASSWORD=changeme_generate_random_password

# =============================================================================
# QUICK START
# =============================================================================
# 1. Create recordings directory:
#    sudo mkdir -p /mnt/orion-cctv
#    sudo chown -R $USER:$USER /mnt/orion-cctv
#
# 2. Create Frigate config from template:
#    cp config/frigate/config.example.yml config/frigate/config.yml
#
# 3. Edit config/frigate/config.yml:
#    - Replace CAMERA_IP with your Tapo camera's IP address
#    - Replace TAPO_USER and TAPO_PASS with your camera account credentials
#      (Set up in Tapo App → Camera Settings → Advanced → Camera Account)
#
# 4. Copy this env file:
#    cp env/.env.nvr.example env/.env.nvr
#
# 5. Start the NVR:
#    make up-nvr
#    # or
#    docker compose -f compose/docker-compose.nvr.yml up -d
#
# 6. Access Frigate:
#    http://localhost:5000
#    https://frigate.orion.lan (if using Traefik gateway)

# =============================================================================
# HARDWARE ACCELERATION (Optional)
# =============================================================================
# For better performance, consider enabling hardware acceleration:
#
# Intel QSV (integrated GPU):
#   1. Uncomment devices section in docker-compose.nvr.yml:
#      devices:
#        - /dev/dri:/dev/dri
#   2. In config/frigate/config.yml, uncomment:
#      ffmpeg:
#        hwaccel_args: preset-vaapi
#
# NVIDIA GPU:
#   1. Install nvidia-docker
#   2. Add runtime: nvidia to compose file
#   3. In config.yml: hwaccel_args: preset-nvidia-h264
#
# Coral TPU (USB):
#   1. Uncomment devices section for USB Coral in docker-compose.nvr.yml
#   2. In config.yml, uncomment coral detector section

# =============================================================================
# HOME ASSISTANT INTEGRATION
# =============================================================================
# To integrate Frigate with Home Assistant:
#
# 1. Enable MQTT in this file and config/frigate/config.yml
# 2. Install Frigate integration in Home Assistant:
#    - Settings → Devices & Services → Add Integration → Frigate
#    - URL: http://orion_frigate:5000
# 3. Cameras and events will auto-discover

# =============================================================================
# RETENTION CALCULATOR
# =============================================================================
# Estimate storage usage per camera (1080p @ 15fps, H.264):
#   - ~15 GB per day
#   - ~100 GB per week
#   - ~450 GB per month
#
# For 4 cameras recording 24/7 for 7 days:
#   4 cameras × 15 GB/day × 7 days = ~420 GB
#
# Adjust retention in config/frigate/config.yml based on your storage capacity.

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
# View logs:
#   docker logs orion_frigate -f
#
# Check camera connectivity:
#   ffprobe rtsp://user:pass@camera_ip:554/stream1
#
# Common issues:
#   - "Connection refused": Check camera IP and ensure RTSP is enabled in Tapo app
#   - "401 Unauthorized": Verify camera account credentials in Tapo app
#   - High CPU: Enable hardware acceleration or reduce detect resolution
#   - Out of memory: Increase shm_size or reduce number of cameras
