# Prometheus Configuration
# See: https://prometheus.io/docs/prometheus/latest/configuration/configuration/

global:
  scrape_interval: 15s
  evaluation_interval: 30s
  external_labels:
    monitor: 'orion-sentinel-core'
    environment: 'production'

# Alertmanager configuration (optional - configure later)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Rule files (for alerts - configure later)
# rule_files:
#   - '/etc/prometheus/rules/*.yml'

# Scrape configurations
scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          node: 'coresrv'
          service: 'prometheus'

  # ===========================================================================
  # CoreSrv Targets (this machine)
  # ===========================================================================
  
  # CoreSrv Node Exporter (host metrics: CPU, RAM, disk, network)
  - job_name: 'coresrv-node'
    static_configs:
      - targets: ['localhost:9100']
        labels:
          node: 'coresrv'
          instance: 'coresrv'
          role: 'services-hub'

  # CoreSrv cAdvisor (Docker container metrics)
  - job_name: 'coresrv-cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          node: 'coresrv'
          instance: 'coresrv'
          role: 'services-hub'

  # Traefik metrics (if enabled in traefik.yml)
  # - job_name: 'traefik'
  #   static_configs:
  #     - targets: ['traefik:8082']
  #       labels:
  #         node: 'coresrv'
  #         service: 'traefik'

  # ===========================================================================
  # Pi DNS Node (Pi 5 #1) - Optional targets (tolerate when unavailable)
  # ===========================================================================
  
  # Pi DNS - Node Exporter
  - job_name: 'pi-dns-node'
    static_configs:
      - targets: ['192.168.8.240:9100']
        labels:
          node: 'pi-dns'
          instance: 'pi-dns'
          role: 'dns-server'
    # Tolerate target being down - Prometheus won't fail startup
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: '192.168.8.240:9100'

  # Pi DNS - Pi-hole Exporter
  # See: https://github.com/eko/pihole-exporter
  - job_name: 'pihole'
    static_configs:
      - targets: ['192.168.8.240:9617']
        labels:
          node: 'pi-dns'
          service: 'pihole'
          role: 'dns-server'

  # Pi DNS - Unbound Exporter
  # See: https://github.com/letsencrypt/unbound_exporter
  - job_name: 'unbound'
    static_configs:
      - targets: ['192.168.8.240:9167']
        labels:
          node: 'pi-dns'
          service: 'unbound'
          role: 'dns-server'

  # ===========================================================================
  # Pi NetSec Node (Pi 5 #2) - Optional targets (tolerate when unavailable)
  # ===========================================================================
  
  # Pi NetSec - Node Exporter
  - job_name: 'pi-netsec-node'
    static_configs:
      - targets: ['192.168.8.241:9100']
        labels:
          node: 'pi-netsec'
          instance: 'pi-netsec'
          role: 'security-monitoring'

  # TODO: Configure Orion Sentinel to export Prometheus metrics
  # TODO: Adjust IP address and port to match your Orion Sentinel deployment
  # Pi NetSec - Orion Sentinel Metrics (custom)
  # - job_name: 'orion-sentinel'
  #   static_configs:
  #     - targets: ['192.168.8.241:9090']  # ← ADJUST THIS IP and PORT
  #       labels:
  #         node: 'pi-netsec'
  #         service: 'orion-sentinel'
  #         role: 'security-monitoring'

  # ===========================================================================
  # Additional CoreSrv Service Exporters (optional)
  # ===========================================================================

  # qBittorrent Exporter (optional)
  # See: https://github.com/caseyscarborough/qbittorrent-exporter
  # - job_name: 'qbittorrent'
  #   static_configs:
  #     - targets: ['qbittorrent-exporter:9022']
  #       labels:
  #         node: 'coresrv'
  #         service: 'qbittorrent'

  # ===========================================================================
  # Home Automation Services
  # ===========================================================================

  # Home Assistant - Prometheus integration
  # Enable via HA UI: Settings → Devices & Services → Add Integration → Prometheus
  # Then configure to expose on port 8123 at /api/prometheus
  - job_name: 'homeassistant'
    metrics_path: '/api/prometheus'
    scheme: 'http'
    static_configs:
      - targets: ['homeassistant:8123']
        labels:
          node: 'coresrv'
          service: 'homeassistant'
          stack: 'home-automation'
    # Use bearer token authentication if required
    # Uncomment and set your long-lived access token from HA
    # authorization:
    #   credentials: 'your-long-lived-access-token-here'

  # Mosquitto MQTT Broker Exporter (optional)
  # Requires mosquitto-exporter sidecar
  # See: https://github.com/sapcc/mosquitto-exporter
  # - job_name: 'mosquitto'
  #   static_configs:
  #     - targets: ['mosquitto-exporter:9234']
  #       labels:
  #         node: 'coresrv'
  #         service: 'mosquitto'
  #         stack: 'home-automation'

  # Zigbee2MQTT - Built-in Prometheus metrics
  # Available at /metrics endpoint when enabled in configuration.yaml
  # - job_name: 'zigbee2mqtt'
  #   static_configs:
  #     - targets: ['zigbee2mqtt:9000']  # Default metrics port
  #       labels:
  #         node: 'coresrv'
  #         service: 'zigbee2mqtt'
  #         stack: 'home-automation'

  # DSMR Reader - Metrics via HTTP endpoint
  # DSMR exposes stats at /dsmr-reader/status endpoint
  # Can use blackbox exporter or custom exporter
  # - job_name: 'dsmr'
  #   metrics_path: '/dsmr-reader/status'
  #   static_configs:
  #     - targets: ['dsmr:80']
  #       labels:
  #         node: 'coresrv'
  #         service: 'dsmr'
  #         stack: 'home-automation'

  # Blackbox exporter for HTTP monitoring of web UIs
  # Uncomment to monitor availability of home automation services
  # - job_name: 'blackbox-home-automation'
  #   metrics_path: /probe
  #   params:
  #     module: [http_2xx]
  #   static_configs:
  #     - targets:
  #         - http://homeassistant:8123
  #         - http://zigbee2mqtt:8080
  #         - http://mealie:9000
  #         - http://dsmr:80
  #   relabel_configs:
  #     - source_labels: [__address__]
  #       target_label: __param_target
  #     - source_labels: [__param_target]
  #       target_label: instance
  #     - target_label: __address__
  #       replacement: blackbox-exporter:9115

# Storage retention (overridden by command line flags in compose.yml)
# Default: 15 days (configured via PROMETHEUS_RETENTION_TIME in env)
