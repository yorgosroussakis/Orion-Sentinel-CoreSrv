# ============================================================================
# Orion-Sentinel-CoreSrv - Master Environment Configuration
# ============================================================================
#
# This is the master .env.example file that consolidates all common settings
# across all modules. Copy this to .env and customize for your deployment.
#
# Quick Start:
#   1. Copy this file: cp .env.example .env
#   2. Edit .env with your settings (domains, paths, credentials)
#   3. Choose profiles: export COMPOSE_PROFILES=core-media,traefik,observability
#   4. Deploy: make up-core  OR  docker compose up -d
#
# For module-specific settings, see env/.env.<module>.example files.
#
# ============================================================================

# ============================================================================
# CORE SYSTEM SETTINGS
# ============================================================================

# User and Group IDs - Run 'id' on your host to find these values
# All containers will run with these IDs for proper file permissions
PUID=1000
PGID=1000

# Timezone - Set to your local timezone
# Full list: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
TZ=Europe/Amsterdam

# ============================================================================
# DOMAIN CONFIGURATION
# ============================================================================

# Base domain for all services
# Services will be accessible at: <service>.<DOMAIN>
# Examples:
#   - jellyfin.example.lan
#   - grafana.example.lan
#   - homeassistant.example.lan
#
# For local development, use '.local' or add entries to /etc/hosts or Pi-hole
DOMAIN=orion.lan

# Local domain for Dell deployment (used by stacks/)
# Configure this in Pi-hole Local DNS (see README.md)
LOCAL_DOMAIN=orion.lan

# Traefik HTTP port (default 80)
TRAEFIK_HTTP_PORT=80

# Email for Let's Encrypt SSL certificates (required for production HTTPS)
# Leave empty for local development with self-signed certs
ACME_EMAIL=

# ============================================================================
# STORAGE PATHS
# ============================================================================
# All persistent data is stored under these root directories
# Customize these paths based on your disk layout

# Core services data root (Traefik, Authelia, Redis, etc.)
CORE_ROOT=/srv/orion-sentinel-core/core

# Media stack data root (configs, metadata, etc.)
MEDIA_CONFIG_ROOT=/srv/orion-sentinel-core/media/config

# Media content root (downloads and library)
MEDIA_ROOT=/srv/orion-sentinel-core/media/content

# Monitoring/Observability data root
MONITORING_ROOT=/srv/orion-sentinel-core/monitoring

# Home automation data root
HOME_AUTOMATION_ROOT=/srv/orion-sentinel-core/home-automation

# Cloud services data root (Nextcloud, etc.)
CLOUD_ROOT=/srv/orion-sentinel-core/cloud

# Maintenance services data root (Homepage, Watchtower, etc.)
MAINTENANCE_ROOT=/srv/orion-sentinel-core/maintenance

# ============================================================================
# DELL STORAGE CONFIGURATION (Two-Tier Storage Model)
# ============================================================================
# Standardized Orion paths for Dell deployment with master/replica external SSDs
#
# Physical layout:
#   - Internal disk: OS, configs, databases, application state
#   - External SSD master (/mnt/SMSNG4T1): Media, cameras, backups
#   - External SSD replica (/mnt/SMSNG4T2): Mirror of master for redundancy
#
# Run scripts/bootstrap-storage.sh to set up bind mounts

# Standardized root directories (used by compose files)
ORION_INTERNAL_ROOT=/srv/orion/internal
ORION_EXTERNAL_PRIMARY=/srv/orion/external_primary
ORION_EXTERNAL_REPLICA=/srv/orion/external_replica

# Derived paths for media, cameras, and backups (on external SSD)
ORION_MEDIA_DIR=${ORION_EXTERNAL_PRIMARY}/media
ORION_CAMERAS_DIR=${ORION_EXTERNAL_PRIMARY}/cameras
ORION_BACKUPS_DIR=${ORION_EXTERNAL_PRIMARY}/backups

# Ownership settings for directories (default to current user)
# Run 'id' to find your UID/GID
ORION_UID=1000
ORION_GID=1000

# Feature toggles for Dell deployment
ENABLE_VPN_PROFILE=false
ENABLE_REVERSE_REPLICATION=false

# ============================================================================
# DELL STORAGE PATH MAPPINGS (use these to override compose defaults)
# ============================================================================
# For Dell deployment, set these variables to use the Orion storage structure:
#
# Service configs (internal disk):
#   GATEWAY_CONFIG_ROOT=${ORION_INTERNAL_ROOT}/appdata/gateway
#   MEDIA_CONFIG_ROOT=${ORION_INTERNAL_ROOT}/appdata/media
#   HOMEAUTO_CONFIG_ROOT=${ORION_INTERNAL_ROOT}/appdata/homeauto
#   OBSERVABILITY_CONFIG_ROOT=${ORION_INTERNAL_ROOT}/observability
#
# Media content (external SSD):
#   MEDIA_ROOT=${ORION_MEDIA_DIR}
#
# Example for full Dell deployment:
#   1. Run ./scripts/bootstrap-storage.sh
#   2. Uncomment and configure the mappings above
#   3. Run ./scripts/orionctl up <stack>

# ============================================================================
# GATEWAY / TRAEFIK CONFIGURATION
# ============================================================================

# Directory for Traefik configuration and certificates
GATEWAY_CONFIG_ROOT=/srv/orion-sentinel-core/core/traefik

# Traefik dashboard domain
TRAEFIK_DOMAIN=traefik.${DOMAIN}

# Enable Traefik access logs (can be verbose)
TRAEFIK_ACCESS_LOGS=false

# ============================================================================
# AUTHELIA (SSO) SECRETS - **CRITICAL: MUST CHANGE BEFORE DEPLOYMENT**
# ============================================================================
# Generate each secret with: openssl rand -hex 32
#
# WARNING: Using default/example values is a SECURITY RISK!
# Generate unique secrets before starting in production.

# JWT secret for Authelia authentication tokens
AUTHELIA_JWT_SECRET=changeme-run-openssl-rand-hex-32-to-generate

# Session secret for encrypted session cookies
AUTHELIA_SESSION_SECRET=changeme-run-openssl-rand-hex-32-to-generate

# Storage encryption key for Authelia database encryption
AUTHELIA_STORAGE_ENCRYPTION_KEY=changeme-run-openssl-rand-hex-32-to-generate

# Authelia domain
AUTHELIA_DOMAIN=auth.${DOMAIN}

# ============================================================================
# MEDIA STACK CONFIGURATION
# ============================================================================

# VPN Configuration (for torrent privacy)
# Only required if using VPN profile for qBittorrent
VPN_ENABLED=false
VPN_SERVICE_PROVIDER=protonvpn
VPN_TYPE=wireguard

# ProtonVPN WireGuard credentials (get from ProtonVPN account)
# Leave empty if not using VPN
VPN_WIREGUARD_PRIVATE_KEY=
VPN_WIREGUARD_ADDRESS=10.2.0.2/32
VPN_ENDPOINT_PORT=51820
VPN_COUNTRY=Netherlands

# Media service API keys (auto-generated after first startup)
# Retrieve from each service's settings UI after deployment
SONARR_API_KEY=
RADARR_API_KEY=
JELLYFIN_API_KEY=

# Jellyseerr domain
JELLYSEERR_DOMAIN=requests.${DOMAIN}

# ============================================================================
# MONITORING / OBSERVABILITY CONFIGURATION
# ============================================================================

# Prometheus retention period (how long to keep metrics)
PROMETHEUS_RETENTION_TIME=15d

# Grafana admin credentials
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme-secure-password

# Grafana domain
GRAFANA_DOMAIN=grafana.${DOMAIN}

# Prometheus domain
PROMETHEUS_DOMAIN=prometheus.${DOMAIN}

# Loki retention period (how long to keep logs)
LOKI_RETENTION_PERIOD=720h

# Uptime Kuma domain
UPTIME_KUMA_DOMAIN=uptime.${DOMAIN}

# NetAlertX (Network Mapping) configuration
NETALERTX_SCAN_INTERVAL=5
NETALERTX_SCAN_SUBNET=

# ============================================================================
# HOME AUTOMATION CONFIGURATION
# ============================================================================

# Home Assistant domain
HOMEASSISTANT_DOMAIN=ha.${DOMAIN}

# Zigbee coordinator device path
# Find your device: ls -l /dev/serial/by-id/
# Common paths: /dev/ttyACM0, /dev/ttyUSB0
ZIGBEE_DEVICE=/dev/ttyACM0

# Zigbee2MQTT domain
ZIGBEE2MQTT_DOMAIN=zigbee.${DOMAIN}

# MQTT broker credentials (for Mosquitto)
# Change these for security
MQTT_USER=mqtt
MQTT_PASSWORD=changeme-secure-password

# Mealie domain (recipe management)
MEALIE_DOMAIN=mealie.${DOMAIN}

# Mealie database credentials (Postgres)
MEALIE_DB_NAME=mealie
MEALIE_DB_USER=mealie
MEALIE_DB_PASSWORD=mealie-secure-password
MEALIE_ALLOW_SIGNUP=false

# Mealie Recipe Sync configuration
MEALIE_BASE_URL=http://mealie:9000
MEALIE_API_TOKEN=
MEALIE_SYNC_INTERVAL_MINUTES=360
MEALIE_MAX_RECIPES_PER_RUN=20

# DSMR Reader configuration (Dutch smart meter)
# P1 port device path (typically /dev/ttyUSB0)
DSMR_DEVICE=/dev/ttyUSB0
DSMR_DOMAIN=dsmr.${DOMAIN}

# DSMR database credentials (Postgres)
DSMR_DB_NAME=dsmrreader
DSMR_DB_USER=dsmrreader
DSMR_DB_PASSWORD=dsmr-secure-password
DSMR_USER=admin
DSMR_EMAIL=admin@orion.lan
DSMR_PASSWORD=dsmr-secure-password
DSMR_DATALOGGER_MODE=standalone

# ============================================================================
# CLOUD SERVICES CONFIGURATION
# ============================================================================

# Nextcloud domain
NEXTCLOUD_DOMAIN=cloud.${DOMAIN}

# Nextcloud admin credentials
NEXTCLOUD_ADMIN_USER=admin
NEXTCLOUD_ADMIN_PASSWORD=changeme-secure-password

# Nextcloud database configuration
NEXTCLOUD_DB_NAME=nextcloud
NEXTCLOUD_DB_USER=nextcloud
NEXTCLOUD_DB_PASSWORD=changeme-secure-password

# Nextcloud Redis password
NEXTCLOUD_REDIS_PASSWORD=redis-change-me

# Nextcloud performance settings
NEXTCLOUD_PHP_MEMORY_LIMIT=512M
NEXTCLOUD_PHP_UPLOAD_LIMIT=10G

# ============================================================================
# FINANCE SERVICES CONFIGURATION (Firefly III)
# ============================================================================

# Firefly III domain
FIREFLY_DOMAIN=firefly.${DOMAIN}

# Firefly III APP_KEY (REQUIRED - 32 characters)
# Generate with: head /dev/urandom | LC_ALL=C tr -dc 'A-Za-z0-9' | head -c 32 && echo
# Or: docker run --rm fireflyiii/core:latest php artisan key:generate --show
FIREFLY_APP_KEY=SomeRandomStringOf32CharsExactly

# Firefly III database configuration
FIREFLY_DB_NAME=firefly
FIREFLY_DB_USER=firefly
FIREFLY_DB_PASSWORD=changeme-secure-password

# Firefly III Data Importer token (generate after first setup in Firefly UI)
FIREFLY_IMPORTER_TOKEN=

# Optional: Mail configuration for Firefly III
FIREFLY_MAIL_MAILER=log
FIREFLY_MAIL_HOST=
FIREFLY_MAIL_PORT=587
FIREFLY_MAIL_FROM=firefly@orion.lan
FIREFLY_MAIL_USERNAME=
FIREFLY_MAIL_PASSWORD=
FIREFLY_MAIL_ENCRYPTION=tls

# Optional: Bank import integrations
FIREFLY_NORDIGEN_ID=
FIREFLY_NORDIGEN_KEY=
FIREFLY_SPECTRE_APP_ID=
FIREFLY_SPECTRE_SECRET=

# ============================================================================
# MAINTENANCE / DASHBOARD CONFIGURATION
# ============================================================================

# Homepage/Dashy domain (dashboard)
HOMEPAGE_DOMAIN=home.${DOMAIN}

# Watchtower - automatic container updates
# Set to 'true' to enable automatic updates (use with caution!)
WATCHTOWER_ENABLED=false

# ============================================================================
# DOCKER COMPOSE PROFILES
# ============================================================================
# Uncomment the profiles you want to enable
# You can also set this via: export COMPOSE_PROFILES=core-media,traefik
#
# Available profiles:
#   - core-media    : Jellyfin, qBittorrent, Sonarr, Radarr, Prowlarr, Jellyseerr
#   - traefik       : Traefik reverse proxy + Authelia SSO
#   - observability : Prometheus, Grafana, Loki, Uptime Kuma
#   - home-automation : Home Assistant, Zigbee2MQTT, Mosquitto, Mealie
#   - extras        : Additional utilities and services

# Default: Start with core media stack
# COMPOSE_PROFILES=core-media

# Production setup: All essential services
# COMPOSE_PROFILES=core-media,traefik,observability

# Full stack: Everything enabled
# COMPOSE_PROFILES=core-media,traefik,observability,home-automation,extras

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================

# Docker network subnet (change if conflicts with your local network)
DOCKER_SUBNET=172.20.0.0/16

# Enable debug logging for troubleshooting
DEBUG=false

# Container restart policy (unless-stopped, always, on-failure, no)
RESTART_POLICY=unless-stopped

# ============================================================================
# SECURITY NOTES
# ============================================================================
#
# 1. NEVER commit this .env file with real secrets to version control!
#    It's already in .gitignore, but be careful when sharing code.
#
# 2. Store your .env file securely (password manager, encrypted backup)
#
# 3. Use strong, unique passwords for all services
#
# 4. Rotate secrets periodically (every 6-12 months minimum)
#
# 5. For production, consider using Docker secrets instead of env vars:
#    https://docs.docker.com/engine/swarm/secrets/
#
# 6. Enable 2FA in Authelia for all admin users
#
# 7. Use VPN for torrent traffic to protect your privacy
#
# ============================================================================
# DIRECTORY STRUCTURE
# ============================================================================
#
# After running setup, your directory structure will be:
#
# /srv/orion-sentinel-core/
# ├── core/
# │   ├── traefik/          # Reverse proxy configs
# │   ├── authelia/         # SSO configs and user database
# │   └── redis/            # Session storage
# ├── media/
# │   ├── config/           # Service configs (Jellyfin, Sonarr, etc.)
# │   │   ├── jellyfin/
# │   │   ├── sonarr/
# │   │   ├── radarr/
# │   │   └── ...
# │   └── content/          # Media files
# │       ├── downloads/    # qBittorrent downloads
# │       │   ├── movies/
# │       │   └── tv/
# │       └── library/      # Organized media library
# │           ├── movies/
# │           └── tv/
# ├── monitoring/
# │   ├── prometheus/
# │   ├── grafana/
# │   ├── loki/
# │   └── uptime-kuma/
# ├── home-automation/
# │   ├── homeassistant/
# │   ├── zigbee2mqtt/
# │   ├── mosquitto/
# │   └── mealie/
# ├── nvr/
# │   └── frigate/           # Frigate config files
# └── cloud/
#     └── nextcloud/
#
# ============================================================================

# ============================================================================
# NVR / FRIGATE CONFIGURATION (Camera Recording)
# ============================================================================

# Camera recordings storage path (primary/hot storage)
# IMPORTANT: Point this to a large SSD with sufficient storage
# For Dell deployment: Use ${ORION_EXTERNAL_PRIMARY}/cameras or ${ORION_CAMERAS_DIR}
# Recordings are kept here for 14 days before being moved to backup
ORION_CCTV_MEDIA_DIR=/mnt/orion-cctv

# Camera recordings backup path (secondary/archive storage)
# Recordings older than 14 days are moved here and kept for another ~30 days
# Can be slower storage (HDD) as it's for archival purposes
# Total retention: 14 days (primary) + 30 days (backup) = ~44 days
ORION_CCTV_BACKUP_DIR=/mnt/orion-cctv-backup

# Shared memory size for Frigate video processing
# 64mb per camera is a good baseline; for 7 cameras use 512mb or more
FRIGATE_SHM_SIZE=512mb

# MQTT integration (optional - enables Home Assistant integration)
# Set to 'orion_mosquitto' if running the home stack (stacks/home/stack.yaml)
# Leave empty to disable MQTT (Frigate will still work for recording)
FRIGATE_MQTT_HOST=
FRIGATE_MQTT_USER=frigate
FRIGATE_MQTT_PASSWORD=change_me

# Internal RTSP restream password (optional)
FRIGATE_RTSP_PASSWORD=

# ============================================================================
