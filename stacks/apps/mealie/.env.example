# ============================================================================
# Mealie Stack Environment Configuration
# ============================================================================
#
# Copy this file to .env and customize for your deployment:
#   cp .env.example .env
#   nano .env
#
# ============================================================================

# ============================================================================
# TIMEZONE
# ============================================================================
TZ=Europe/Amsterdam

# ============================================================================
# MEALIE DATABASE (Postgres)
# ============================================================================

# Database name
MEALIE_DB_NAME=mealie

# Database user
MEALIE_DB_USER=mealie

# Database password (REQUIRED - change this!)
# Generate with: openssl rand -base64 32
MEALIE_POSTGRES_PASSWORD=changeme-generate-secure-password

# ============================================================================
# MEALIE APPLICATION
# ============================================================================

# Base URL - should match how you access Mealie externally
# For LAN-only access: http://192.168.8.205:9000
# For Traefik proxy: https://mealie.orion.lan
MEALIE_BASE_URL=http://192.168.8.205:9000

# Allow new user signups (false for private instance)
MEALIE_ALLOW_SIGNUP=false

# Log level (DEBUG, INFO, WARNING, ERROR)
MEALIE_LOG_LEVEL=INFO

# API documentation endpoint
MEALIE_API_DOCS=true

# Token validity time in hours
MEALIE_TOKEN_TIME=720

# Performance settings (adjust based on server resources)
MEALIE_MAX_WORKERS=1
MEALIE_WEB_CONCURRENCY=1

# ============================================================================
# OPENAI INTEGRATION (Optional)
# ============================================================================

# OpenAI API key for recipe suggestions and AI features
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=

# OpenAI model to use
OPENAI_MODEL=gpt-4o

# Enable AI image services
OPENAI_ENABLE_IMAGE_SERVICES=false

# ============================================================================
# MEALIE IMPORTER CONFIGURATION
# ============================================================================

# Mealie API token for the importer (REQUIRED for importer)
# Generate in Mealie: Settings → API Tokens → Create Token
# Give it a descriptive name like "Recipe Importer Service"
MEALIE_IMPORTER_TOKEN=

# Internal URL for importer to reach Mealie (uses container name)
MEALIE_IMPORTER_BASE_URL=http://mealie:9000

# Backfill mode settings (initial import)
MEALIE_BACKFILL_PER_SITE=75
MEALIE_BACKFILL_TOTAL_CAP=1500

# Monthly mode settings (delta updates)
MEALIE_MONTHLY_PER_SITE=40
MEALIE_MONTHLY_TOTAL_CAP=800

# Rate limiting (seconds between requests per domain)
MEALIE_THROTTLE_SECONDS=1.0

# Request timeout in seconds
MEALIE_REQUEST_TIMEOUT=30

# User agent string for web requests
MEALIE_USER_AGENT=OrionSentinelMealieImporter/1.0 (+local homelab)

# Importer data directory (SQLite state DB and logs)
MEALIE_IMPORTER_DATA_DIR=./data/mealie-importer

# Cron schedule for monthly imports (1st day at 03:20 local time)
# Format: minute hour day-of-month month day-of-week
MEALIE_CRON_SCHEDULE=20 3 1 * *

# ============================================================================
# TRAEFIK INTEGRATION (Optional)
# ============================================================================

# Domain for Traefik routing
DOMAIN=orion.lan

# ============================================================================
# NOTES
# ============================================================================
#
# 1. MEALIE_POSTGRES_PASSWORD is required - generate a secure password!
# 2. MEALIE_IMPORTER_TOKEN is required for the importer to work
#    - First start Mealie without the importer
#    - Create an admin user and generate an API token
#    - Add the token to this file and restart with importer profile
#
# Starting the Stack:
#   # Start Mealie only (without importer)
#   docker compose -f docker-compose.mealie.yml up -d
#
#   # Start Mealie with importer cron
#   docker compose -f docker-compose.mealie.yml --profile importer-cron up -d
#
# Running Backfill:
#   docker compose -f docker-compose.mealie.yml --profile importer run --rm \
#     mealie-importer python /app/importer.py --mode backfill
#
# Running Monthly Import Manually:
#   docker compose -f docker-compose.mealie.yml --profile importer run --rm \
#     mealie-importer python /app/importer.py --mode monthly
#
# ============================================================================
